<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ page.title | default: "OIO Race results" }}</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <style>
      body {
        background-color: #f2f2f2;
        color: #111;
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      }
      .site-header {
        background-color: #000;
        color: #fff;
      }
      .site-header a {
        color: #fff;
        text-decoration: none;
      }
      .content-wrap {
        background-color: #fff;
        border: 1px solid #d9d9d9;
      }
      a {
        color: #111;
      }
      a:hover {
        color: #333;
      }
      .list-group-item {
        background-color: #fff;
        border-color: #d9d9d9;
      }
      .content-wrap table {
        width: 100% !important;
        display: table;
        background-color: #fff;
      }
      th,
      td {
        border: 1px solid #d9d9d9;
        padding: 0.5rem;
      }
      th {
        background-color: #e5e5e5;
      }
      .mobile-action-col,
      .mobile-action-cell,
      .mobile-details-row {
        display: none;
      }
      .mobile-row-toggle {
        border: 1px solid #bfbfbf;
        background: #fff;
        color: #111;
        padding: 0.05rem 0.4rem;
        line-height: 1;
        border-radius: 0.25rem;
        font-size: 0.9rem;
      }
      .mobile-row-toggle:hover,
      .mobile-row-toggle:focus {
        color: #111;
        background: #e5e5e5;
        box-shadow: none;
      }
      .mobile-details-card {
        background-color: #f2f2f2;
        border: 1px solid #d9d9d9;
        border-radius: 0.375rem;
        padding: 0.75rem;
      }
      .mobile-details-item + .mobile-details-item {
        margin-top: 0.35rem;
      }
      @media (max-width: 767.98px) {
        .mobile-hide-col {
          display: none;
        }
        .mobile-action-col,
        .mobile-action-cell {
          display: table-cell;
          width: 1%;
          white-space: nowrap;
          text-align: center;
          vertical-align: middle;
        }
        .mobile-details-row.is-open {
          display: table-row;
        }
      }
    </style>
  </head>
  <body>
    <header class="site-header py-3 mb-4">
      <div class="container">
        <a href="{{ '/' | relative_url }}" class="fs-4 fw-semibold">OIO Race results</a>
      </div>
    </header>

    <main class="container pb-4">
      <section class="content-wrap rounded p-4">
        {{ content }}
      </section>
    </main>
    <script>
      (function () {
        var tables = document.querySelectorAll('.content-wrap table');
        tables.forEach(function (table) {
          var headers = table.querySelectorAll('thead th');
          var headerLabels = Array.from(headers).map(function (header) {
            return header.textContent.trim().toLowerCase();
          });

          var classIndex = headerLabels.indexOf('class');
          var carIndex = headerLabels.indexOf('car');
          var notesIndex = headerLabels.indexOf('notes');
          if (classIndex === -1 || carIndex === -1 || notesIndex === -1) {
            return;
          }

          var hiddenIndexes = [classIndex, carIndex, notesIndex];
          hiddenIndexes.forEach(function (index) {
            if (headers[index]) {
              headers[index].classList.add('mobile-hide-col');
            }
          });

          var actionHeader = document.createElement('th');
          actionHeader.className = 'mobile-action-col';
          actionHeader.setAttribute('aria-label', 'More details');
          actionHeader.textContent = '';
          var headerRow = table.querySelector('thead tr');
          if (!headerRow) {
            return;
          }
          headerRow.appendChild(actionHeader);

          var bodyRows = table.querySelectorAll('tbody tr');
          bodyRows.forEach(function (row) {
            var cells = Array.from(row.querySelectorAll('td'));
            hiddenIndexes.forEach(function (index) {
              if (cells[index]) {
                cells[index].classList.add('mobile-hide-col');
              }
            });

            var detailParts = [
              { label: 'Class', value: cells[classIndex] ? cells[classIndex].innerHTML : '' },
              { label: 'Car', value: cells[carIndex] ? cells[carIndex].innerHTML : '' },
              { label: 'Notes', value: cells[notesIndex] ? cells[notesIndex].innerHTML : '' }
            ];

            var actionCell = document.createElement('td');
            actionCell.className = 'mobile-action-cell';
            var button = document.createElement('button');
            button.type = 'button';
            button.className = 'mobile-row-toggle';
            button.setAttribute('aria-expanded', 'false');
            button.setAttribute('aria-label', 'Show row details');
            button.textContent = '•••';
            actionCell.appendChild(button);
            row.appendChild(actionCell);

            var detailsRow = document.createElement('tr');
            detailsRow.className = 'mobile-details-row';
            var detailsCell = document.createElement('td');
            detailsCell.colSpan = row.children.length;
            detailsCell.innerHTML =
              '<div class="mobile-details-card small">' +
              detailParts
                .map(function (item) {
                  return (
                    '<div class="mobile-details-item"><strong>' +
                    item.label +
                    ':</strong> ' +
                    (item.value || '—') +
                    '</div>'
                  );
                })
                .join('') +
              '</div>';
            detailsRow.appendChild(detailsCell);
            row.parentNode.insertBefore(detailsRow, row.nextSibling);

            button.addEventListener('click', function () {
              var isOpen = detailsRow.classList.toggle('is-open');
              button.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
              button.setAttribute('aria-label', isOpen ? 'Hide row details' : 'Show row details');
            });
          });
        });
      })();
    </script>
  </body>
</html>